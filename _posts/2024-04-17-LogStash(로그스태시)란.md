---
permalink: /2024-04-17-LogStash(로그스태시)란?/
published: true
title: "[ELK] LogStash(로그스태시)란? "
date: 2024-04-17 12:00:00
toc: true
toc_sticky: true
toc_label: "LogStash(로그스태시)란?"
categories:
- ELK
tags:
- ELK
- LogStash
---
<br><br><br>



## ✅ LogStash(로그스태시)란?

LogStash는 실시간 파이프라인 기능을 갖춘 오픈 소스 데이터 수집 엔진이다. LogStash는 서로 다른 소스의 데이터를 동적으로 통합하고 해당 데이터를 원하는 대상으로 정규화할 수 있다.

LogStash는 원래 로그 수집을 위한 목적으로 사용됐지만, 현재는 로그 수집을 넘어서 훨씬 많은 기능을 위해 사용된다. 다양한 범위의 input, output, filter를 통해 많은 유형의 이벤트를 변환 할 수 있으며, 데이터 수집 프로세스를 단순화 한다. 

<br>

<p align="left">
<img src="https://github.com/idkim97/idkim97.github.io/blob/master/img/logstash1.png?raw=true">
</p>

<br><br><br><br><br><br><br>

## ✅ LogStash의 동작 방식

LogStash 이벤트 처리 파이프라인은 **inputs -> filters -> outputs**의 세 단계로 구성된다. inputs은 이벤트를 생성하고, filters는 이벤트를 수정하며, outputs은 이벤트를 다른곳으로 전달한다. LogStash의 입출력은 데이터가 파이프라인에 들어오거나 나갈 때 데이터를 인코딩/디코딩 할 수 있는 코덱을 지원한다.

<br><br><br><br><br>

### 📌 Inputs ( 입력 )
LogStash는 Inputs를 사용하여 데이터를 가져오는데, 일반적으로 많이 사용되는 input은 다음과 같다.

- **file** : UNIX명령어인 `tail -0F` 처럼 파일시스템에서 파일을 읽어온다.
- **syslog** : 514포트를 통해 syslog 메시지를 읽어오고 RFC3164 포맷에 따라 구분한다.
- **redis** : redis 채널과 redis 목록을 모두 사용하여 redis 서버로부터 읽어온다. 
- **[beats](https://www.elastic.co/guide/en/logstash/7.6/plugins-inputs-beats.html)** : Beats에서 보낸 이벤트를 처리한다. 
```ruby
# input으로 beat사용
input {
  beats {
    port => 5044
    host => "0.0.0.0"
    client_inactivity_timeout => 86400
  }
}
```
- **jdbc** : JDBC 데이터를 통해 이벤트를  생성한다.

[LogStash의  Input 플러그인](https://www.elastic.co/guide/en/logstash/7.6/input-plugins.html)은 이외에도 굉장히 많고 필요에 따라 골라서 사용하면 된다.





<br><br><br><br><br>

### 📌 Filters ( 필터 )

필터는 LogStash 파이프라인의 중간 처리 장치이다. 필터를 조건과 결합하여 특정 기준을 충족하는 경우 이벤트에 대한 작업을 수행할 수 있다. 자주 쓰이는 필터는 다음과 같다.
<BR>

- **[grok](https://www.elastic.co/guide/en/logstash/7.6/plugins-filters-grok.html)** : 임의의 텍스트를 분석하고 구조화한다. 현재 LogStash에서 구조화되지 않은 로그데이터를 구조화하고 구문 분석하는 가장 좋은 방법이다. 

```ruby
filter {
    grok {
        match => { "message" => 
        "%{IP:client} %{WORD:method} %{URIPATHPARAM:request} 
        %{NUMBER:바이트} %{NUMBER:기간}" 
        } 
    } 
}
```
<BR>

- **[mutate](https://www.elastic.co/guide/en/logstash/7.6/plugins-filters-mutate.html)** : 이벤트의 필드 이름 변경, 제거, 수정 등의 변환을 수행한다.

```ruby
filter {
    mutate {
        split => ["hostname", "."]
        add_field => { "shortHostname" => "%{hostname[0]}" }
    }

    mutate {
        rename => ["shortHostname", "hostname" ]
    }
}
```
이 구성은 원래의 `hostname` 필드를 점(`.`)으로 구분하여 분할한 후 첫 번째 부분을 `shortHostname` 필드에 추가하고, 마지막으로 `shortHostname` 필드의 이름을 다시 `hostname`으로 변경한다. 이렇게 함으로써, 예를 들어 `example.com`에서 `example`만 추출하여 `hostname` 필드에 저장하는 것과 같은 작업을 수행한다.

<BR>

```ruby
filter {
  mutate {
    remove_field => ['@version','es_contents','@timestamp']    
    add_field => {
      "pk" => "%{kedcd}"
    }   
  }
}
```
위 코드는 `@version`,`es_contents'`,`@timestamp`라는 필드를 삭제하고, `pk`라는 필드를 추가하며 `pk`필드의 값으로는 `kedcd` 필드 값을 사용한다는 의미이다. 한마디로 kedcd필드를 pk필드에 복사하겠다는 의미와 같다.

<br>


- **drop** : 이벤트를 완전히 삭제한다.
```ruby
filter {
	if [loglevel] == "debug" {
	    drop { }
	}
}
```
`loglevel` 필드의 값이 debug인 경우 이벤트를 삭제하겠다는 것을 의미한다.


- **clone** : 이벤트의 복사본을 만들고 필드를 추가하거나 제거할 수 있다.
- **geoip** : IP주소의 지리적 위치에 대한 정보를 추가한다.

<br>

[LogStash의 filter 플러그인](https://www.elastic.co/guide/en/logstash/7.6/filter-plugins.html) 역시 굉장히 많으므로 필요에 따라 공식문서 등을 참고하여 활용하면 되겠다.


<br><br><br><br><br>

### 📌 Outputs ( 출력 )
